\begin{tikzpicture}[>=latex]
% les matrices
\matrix (X) [matrix of math nodes,%
             left delimiter  = {[},%
             right delimiter = {]}] at (0, -1)
{%
  x_{0,0} & \ldots & x_{0,m}  \\
  x_{1,0} & \ldots & x_{1,m}  \\
   \vdots &        & \vdots   \\
  x_{n,0} & \ldots & x_{n,m}  \\
};

%l1
\draw node at (4,2.5) {$u^1_{i,j} = f^1 \left (W^1_{j,k}x_{i,k} + \theta^1_j \right )$};
\draw[fill=black!20, draw=none] (3,2) rectangle (5,-4) {};
\draw node[fill=blue!50, circle] (l1) at (4, 1) {$u^{1}_{i,j}$};
\draw node[fill=green!50, circle] (W1) at (4, -1) {$W^{1}_{i,j}$};
\draw node[fill=green!50, circle] (t1) at (4, -2.5) {$\theta^{1}_{i}$};

\draw [->,thick]%
([xshift=0.4cm]X.east) to%
([xshift=-0.2cm]l1.south west);

\draw [->,thick]%
([yshift=0.1cm]W1.north) to%
node[yshift = 0.2cm, above]{}%
([yshift=0.-0.1cm]l1.south);

\draw [->, thick, out=135, in=225]%
([yshift=0.1cm]t1.north west) to%
node[yshift = 0.2cm, above]{}%
([yshift=0.-0.1cm]l1.south west);


%l2
\draw node at (8,2.5) {$u^2_{i,j} = f^2 \left (W^2_{j,k}u^1_{i,k} + \theta^2_j \right )$};
\draw[fill=black!20, draw=none] (7,2) rectangle (9,-4) {};
\draw node[fill=blue!50, circle] (l2) at (8, 1) {$u^{2}_{i,j}$};
\draw node[fill=green!50, circle] (W2) at (8, -1) {$W^{2}_{i,j}$};
\draw node[fill=green!50, circle] (t2) at (8, -2.5) {$\theta^{2}_{i}$};

\draw [->,thick]%
([xshift=0.2cm]l1. east) to%
([xshift=-0.2cm]l2.west);

\draw [->,thick]%
([yshift=0.1cm]W2.north) to%
node[yshift = 0.2cm, above]{}%
([yshift=0.-0.1cm]l2.south);

\draw [->, thick, out=135, in=225]%
([yshift=0.1cm]t2.north west) to%
node[yshift = 0.2cm, above]{}%
([yshift=0.-0.1cm]l2.south west);

%ld
\draw node[draw=none] (ld) at (10.5, 1) {$\ldots$};
\draw [->,thick]%
([xshift=0.2cm]l2.east) to%
([xshift=-0.2cm]ld.west);

%lnh
\draw node at (13,2.5) {$u^{n_h}_{i,j} = f^{n_h} \left (W^{n_h}_{j,k}u^{n_h-1}_{i,k} + \theta^{n_h}_j \right )$};
\draw[fill=black!20, draw=none] (12,2) rectangle (14,-4) {};
\draw node[fill=blue!50, circle] (lnh) at (13, 1) {$u^{n_h}_{i,j}$};
\draw node[fill=green!50, circle] (Wnh) at (13, -1) {$W^{n_h}_{i,j}$};
\draw node[fill=green!50, circle] (tnh) at (13, -2.5) {$\theta^{n_h}_{j}$};

\draw [->,thick]%
([xshift=0.2cm]ld.east) to%
([xshift=-0.2cm]lnh.west);

\draw [->,thick]%
([yshift=0.1cm]Wnh.north) to%
node[ above]{}%
([yshift=0.-0.1cm]lnh.south);

\draw [->, thick, out=135, in=225]%
(tnh.north west) to%
node[yshift = 0.2cm, above]{}%
(lnh.south west);

% \matrix (Y) [matrix of math nodes,%
%              left delimiter  = {[},%
%              right delimiter = {]}] at (16, -1)
% {%
%   \hat{y}_{0} \\
%   \hat{y}_{1} \\
%   \vdots\\
%   \hat{y}_{n} \\
% };

% \draw [->, thick]%
% ([xshift=0.2cm]lnh.south east) to%
% ([xshift=-0.4cm]Y.west);

% \matrix (Y) [matrix of math nodes,%
%              left delimiter  = {[},%
%              right delimiter = {]}] at (16, -5)
% {%
% y_{0} \\
% y_{1} \\
% \vdots\\
% y_{n} \\
% };

\draw node[fill=red!50, circle] (E) at (17, -1) {$J(\mathbf{y},\mathbf{\hat{y}})$};
% Error function

\draw [->, thick]%
([xshift=0.4cm]lnh.east) to%
([xshift=-0.2cm]E.west);


% \draw [->,thick, out=35,in=145,looseness=0.75]%
% ([xshift=0.2cm, yshift=0.4cm]l1.north east) to%
% node[yshift = 0.2cm, above]{$u^{1}_{i,j} = f^0\left(W^0_{i,k}u^0_{i,k} + \theta^{n_h-1}_i\right)$}%
% ([xshift=-0.2cm, yshift=0.4cm]l2.north west);



% \draw [->,thick, out=0,in=120,looseness=0.75]%
% ([xshift=0.2cm, yshift=0.4cm]lnh. east) to%
% node[yshift = 0.2cm, right]{$y_i = g\left(W^{l_{n_h}}_{0,k}u^{l_{n_h}}_{i,k} + \theta^{l_{n_h}} \right)$}%
% \matrix (B) [matrix of math nodes,%
%              left delimiter  = {[},%
%              right delimiter = {]}] at (5, 0)
% {%
%   u^{l+1}_{0,0} & \ldots & u^{l+1}_{0,m}  \\
%   u^{l+1}_{1,0} & \ldots & u^{l+1}_{1,m}  \\
%    \vdots &        & \vdots   \\
%   u^{l+1}_{n,0} & \ldots & u^{l+1}_{n,m}  \\
% };

% \matrix (dA) [matrix of math nodes,%
%              left delimiter  = {[},%
%              right delimiter = {]}] at (0, -4)
% {%
%   \frac{dy}{dW^l_{0,0}} & \ldots & \frac{dy}{dW^l_{0,m}}  \\
%   \frac{dy}{dW^l_{1,0}} & \ldots & \frac{dy}{dW^l_{1,m}}  \\
%    \vdots &        & \vdots   \\
%   \frac{dy}{dW^l_{n,0}} & \ldots & \frac{dy}{dW^l_{n,m}}  \\
% };

% \matrix (dB) [matrix of math nodes,%
%              left delimiter  = {[},%
%              right delimiter = {]}] at (5, -4)
% {%
%   \frac{dy}{dW^{l+1}_{0,0}} & \ldots & \frac{dy}{dW^{l+1}_{0,m}}  \\
%   \frac{dy}{dW^{l+1}_{1,0}} & \ldots & \frac{dy}{dW^{l+1}_{1,m}}  \\
%    \vdots &        & \vdots   \\
%   \frac{dy}{dW^{l+1}_{n,0}} & \ldots & \frac{dy}{dW^{l+1}_{n,m}}  \\
% };

% \matrix (C) [matrix of math nodes,%
%              left delimiter  = {[},%
%              right delimiter = {]}] at (10, 0)
% {%
%   u^2_{0,0} & \ldots & u^2_{0,m}  \\
%   u^2_{1,0} & \ldots & u^2_{1,m}  \\
%    \vdots &        & \vdots   \\
%   u^2_{n,0} & \ldots & u^2_{n,m}  \\
% };


    % \draw [->,thick, out=-135,in=-45,looseness=0.75]%
    % ([xshift=-0.4cm, yshift=-0.4cm]dB.south west) to
    % node[yshift = 0.2cm, below]{$\frac{dy}{du^{l+1}_{i,j}} = f^{l+1}_i\left( W^{l+1}_{ik} u^l_{j,k} + \theta^{1+1}_i \right)$}%
    % ([xshift=0.4cm, yshift=-0.4cm]dA.south east);

  % l layer
% \draw node[draw=black, circle, minwidth=2cm] (A) at (1, 0) {$u^{l}_{i,j}$};
% \draw node[draw=black, circle, minwidth=2cm] (dAu) at (1, -3) {$\frac{dy}{du^{l}_{i,j}$};
% \draw node[draw=black, circle, minwidth=2cm] (dAw) at (1, -5) {$\frac{dy}{dW^{l}_{i,j}$};
% \draw node[draw=black, circle, minwidth=2cm] (dAt) at (1, -7) {$\frac{dy}{d\theta^l_{i}$};

  % l+1 layer
% \draw node[draw=black, circle, minwidth=2cm] (B) at (5, 0) {$u^{l+1}_{i,j}$};
% \draw node[draw=black, circle, minwidth=2cm] (dBu) at (5, -3) {$\frac{dy}{du^{l+1}_{i,j}$};
% \draw node[draw=black, circle, minwidth=2cm] (dBw) at (5, -5) {$\frac{dy}{dW^{l+1}_{i,j}$};
% \draw node[draw=black, circle, minwidth=2cm] (dBt) at (5, -7) {$\frac{dy}{d\theta^{l+1}_{i}$};


% \draw [->,thick, out=135,in=45,looseness=0.75]%
% ([xshift=0.4cm, yshift=+0.4cm]dBu.north west) to%
% node[above]{$\frac{dy}{du^{l}_{i,j}} = W^l_{i,k} \frac{df}{dx}\left(W^l_{i,m}u^l_{i,m}+\theta^l_i\right) \frac{dy}{du^{l+1}_{i,j}}$}
% ([xshift=-0.4cm, yshift=+0.4cm]dAu.north east);
\end{tikzpicture}
%%% Local Variables:
%%% mode: latex
%%% TeX-master: t
%%% End:
